<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ì œ ì§€í‘œ ì°¨íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        canvas { 
            max-width: 100%; 
            width: 1000px; /* ì°¨íŠ¸ í¬ê¸° */
            height: 600px; /* ì°¨íŠ¸ ë†’ì´ */
            margin: 20px auto;
        }
        .checkbox-container { text-align: center; margin: 20px; }
        .checkbox-container label { margin-right: 10px; }
        .tab-container { margin: 20px; }
        .tab-button { padding: 10px; margin: 0 5px; cursor: pointer; border: 1px solid #ccc; }
        .tab-button.active { background-color: #4CAF50; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ“Š êµ­ê°€ë³„ ê²½ì œ ì§€í‘œ</h1>

    <div class="checkbox-container">
        <label><input type="checkbox" class="country-checkbox" value="KR" checked> í•œêµ­</label>
        <label><input type="checkbox" class="country-checkbox" value="US" checked> ë¯¸êµ­</label>
        <label><input type="checkbox" class="country-checkbox" value="CN" checked> ì¤‘êµ­</label>
        <label><input type="checkbox" class="country-checkbox" value="JP" checked> ì¼ë³¸</label>
        <label><input type="checkbox" class="country-checkbox" value="AU" checked> í˜¸ì£¼</label>
        <label><input type="checkbox" class="country-checkbox" value="LA" checked> ë¼ì˜¤ìŠ¤</label>
        <label><input type="checkbox" class="country-checkbox" value="ID" checked> ì¸ë„ë„¤ì‹œì•„</label>
    </div>

    <div class="tab-container">
        <button class="tab-button active" data-tab="GDP">ê²½ì œ ì„±ì¥ë¥  (GDP)</button>
        <button class="tab-button" data-tab="INFLATION">ì¸í”Œë ˆì´ì…˜</button>
        <button class="tab-button" data-tab="POVERTY">ë¹ˆê³¤ìœ¨</button>
    </div>

    <canvas id="growthChart"></canvas>

    <script>
        // êµ­ê°€ ì½”ë“œ -> êµ­ê°€ëª… ë§¤í•‘
        const countryCodes = {
            "KR": "í•œêµ­",
            "US": "ë¯¸êµ­",
            "CN": "ì¤‘êµ­",
            "JP": "ì¼ë³¸",
            "AU": "í˜¸ì£¼",
            "LA": "ë¼ì˜¤ìŠ¤",
            "ID": "ì¸ë„ë„¤ì‹œì•„"
        };

        // World Bank API URL (GDP, ì¸í”Œë ˆì´ì…˜, ë¹ˆê³¤ìœ¨)
        const apiUrls = {
            "GDP": (code) => `https://api.worldbank.org/v2/country/${code}/indicator/NY.GDP.MKTP.KD.ZG?format=json`,
            "INFLATION": (code) => `https://api.worldbank.org/v2/country/${code}/indicator/FP.CPI.TOTL.ZG?format=json`,
            "POVERTY": (code) => `https://api.worldbank.org/v2/country/${code}/indicator/SI.POV.DDAY?format=json`
        };

        let chart;
        let selectedIndicator = "GDP"; // ê¸°ë³¸ ì„ íƒì€ GDP

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchEconomicData() {
            const selectedCountries = Array.from(document.querySelectorAll('.country-checkbox:checked'))
                                           .map(checkbox => checkbox.value);

            const data = {};

            // ê° ë‚˜ë¼ë³„ë¡œ API í˜¸ì¶œ
            for (let code of selectedCountries) {
                const response = await fetch(apiUrls[selectedIndicator](code));
                const json = await response.json();
                
                if (json[1]) {
                    // ë‚˜ë¼ë³„ ë°ì´í„° ì €ì¥
                    data[countryCodes[code]] = json[1].map(entry => ({
                        year: entry.date,
                        value: entry.value
                    }));
                }
            }
            return data;
        }

        // ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜
        function createChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'ì§€í‘œ ê°’' }
                        },
                        x: {
                            title: { display: true, text: 'ì—°ë„' }
                        }
                    }
                }
            });
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateChart(data) {
            const labels = Object.values(data).length > 0 && Object.values(data)[0]
                            ? Object.values(data)[0].map(entry => entry.year).reverse()
                            : [];

            chart.data.labels = labels;

            chart.data.datasets = [];
            Object.keys(data).forEach(country => {
                chart.data.datasets.push({
                    label: `${country} - ${selectedIndicator}`,
                    data: data[country].map(entry => entry.value).reverse(),
                    borderColor: getColor(country),
                    fill: false,
                    tension: 0.1 // ê³¡ì„  íš¨ê³¼
                });
            });

            chart.update();
        }

        // êµ­ê°€ë³„ ìƒ‰ìƒ ì§€ì •
        function getColor(country) {
            const colors = {
                "í•œêµ­": "blue", "ë¯¸êµ­": "red", "ì¤‘êµ­": "green", "ì¼ë³¸": "purple",
                "í˜¸ì£¼": "orange", "ë¼ì˜¤ìŠ¤": "brown", "ì¸ë„ë„¤ì‹œì•„": "pink"
            };
            return colors[country] || "gray";
        }

        // íƒ­ ë³€ê²½ ê¸°ëŠ¥
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', async (event) => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');

                selectedIndicator = event.target.getAttribute('data-tab'); // ì„ íƒí•œ ì§€í‘œ ì—…ë°ì´íŠ¸
                const data = await fetchEconomicData();
                updateChart(data);
            });
        });

        // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ê°ì§€
        document.querySelectorAll('.country-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', async () => {
                const data = await fetchEconomicData();
                updateChart(data);
            });
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', async () => {
            createChart();
            const data = await fetchEconomicData();
            updateChart(data);
        });
    </script>
</body>
</html>
